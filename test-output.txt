
> betrix-ui@2.0.0 test
> node ./scripts/run-all-tests.js

Environment: node v22.21.0 npm unknown platform win32
Running Node built-in tests...
Debug: nodeFiles count: 27
Debug: node args: [
  '--test',
  '--test-reporter=spec',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\ai-provider-failover.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\ai.intent.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\ai.predictor.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\azure-ai.smoke.node.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\cache-service.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\comprehensive-integration.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\news-service.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\onboarding-sim.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\openligadb.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\payment-flow.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\payment-guides.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\payment-integration.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\payment-normalizer.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\providers\\sportradar_soccer.test.mjs',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\rss-aggregator.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\services\\sports_aggregator_sport.test.mjs',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\sportradar.adapter.test.mjs',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\startup-marker.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\startup-rapidapi-registered.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\telegram-analyze-ai.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\telegram-analyze.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\telegram-bot.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\telegram-handler-v2.smoke.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\utils\\interval.node.mjs',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\v3-handlers.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\webhook-auth.test.js',
  'D:\\betrix-ui (1)\\betrix-ui\\tests\\webhook-lipana-signature.test.js'
]
Γ£ö AI provider modules present (158.3045ms)
Γû╢ AI Intent classifier (smoke)
  Γ£ö recognizes command /start (5.1677ms)
  Γ£ö detects odds intent from text (3.225ms)
Γ£ö AI Intent classifier (smoke) (13.9316ms)
Γû╢ AI Predictor (smoke)
  Γ£ö returns probabilities and rationale (4.7019ms)
Γ£ö AI Predictor (smoke) (9.8734ms)
Γ£ö D:\betrix-ui (1)\betrix-ui\tests\azure-ai.smoke.node.js (276.0325ms)
Γ£ö CacheService - basic get/set operations (7.9919ms)
Γ£ö CacheService - rate limiting within bounds (0.8407ms)
Γ£ö CacheService - rate limiting exceeds bounds (2.3583ms)
Γ£ö CacheService - handles null/undefined values gracefully (0.7435ms)
Γ£ö CacheService - serialization/deserialization (0.9514ms)

ΓòöΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòù
Γòæ         COMPREHENSIVE INTEGRATION TEST COMPLETE                Γòæ
ΓòÜΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓò¥

Γ£à NLP Tests: 90+ intent variations tested
Γ£à Command Tests: 9 commands validated
Γ£à Callback Tests: 10+ callback routes working
Γ£à Betting Sites: Kenya bookmakers verified
Γ£à UI/UX: All formatters checked
Γ£à Data Models: Schemas validated
Γ£à Edge Cases: 50+ scenarios tested
Γ£à Error Handling: Graceful failures verified

Total Test Coverage: 
  ΓÇó 100+ natural language intents
  ΓÇó 9 command handlers
  ΓÇó 10+ callback routes
  ΓÇó 6 Kenya betting sites
  ΓÇó 50+ edge cases

Status: ≡ƒÜÇ READY FOR PRODUCTION

Γ£à Core intent classification tests: 19/19 core commands work
Γ£à Edge case tests: 5/5 passed
[2025-12-23T13:24:00.964Z] [INFO] [Commands] handleCommand { cmd: 'start', userId: 123, chatId: 456 }
[2025-12-23T13:24:00.968Z] [INFO] [Commands] handleCommand { cmd: 'help', userId: 123, chatId: 456 }
[2025-12-23T13:24:00.969Z] [INFO] [Commands] handleCommand { cmd: 'menu', userId: 123, chatId: 456 }
[2025-12-23T13:24:00.970Z] [INFO] [Commands] handleCommand { cmd: 'odds', userId: 123, chatId: 456 }
[2025-12-23T13:24:00.971Z] [INFO] [Commands] handleCommand { cmd: 'analyze', userId: 123, chatId: 456 }
[2025-12-23T13:24:00.972Z] [INFO] [Commands] handleCommand { cmd: 'news', userId: 123, chatId: 456 }
[2025-12-23T13:24:00.973Z] [INFO] [Commands] handleCommand { cmd: 'vvip', userId: 123, chatId: 456 }
[2025-12-23T13:24:00.975Z] [INFO] [Commands] handleCommand { cmd: 'pay', userId: 123, chatId: 456 }
[2025-12-23T13:24:00.976Z] [INFO] [Commands] handleCommand { cmd: 'signup', userId: 123, chatId: 456 }
Γ£à All 9 command handlers working correctly
[2025-12-23T13:24:00.981Z] [INFO] [Commands] handleCommand { cmd: 'start', userId: 123, chatId: 456 }
Γ£à /start command formatted correctly
[2025-12-23T13:24:00.983Z] [INFO] [Commands] handleCommand { cmd: 'help', userId: 123, chatId: 456 }
Γ£à /help command working correctly
[2025-12-23T13:24:00.984Z] [INFO] [Commands] handleCommand { cmd: 'menu', userId: 123, chatId: 456 }
Γ£à /menu command working correctly
[2025-12-23T13:24:00.986Z] [INFO] [Commands] handleCommand { cmd: 'unknown123', userId: 123, chatId: 456 }
Γ£à Unknown command handled correctly
Γ£à Kenya betting sites: 6 sites with complete info
Γ£à Betting sites formatted with site details and bonuses
[2025-12-23T13:24:00.991Z] [INFO] [Commands] handleCommand { cmd: 'odds', userId: 123, chatId: 456 }
Γ£à Odds command returns structured response with buttons
[2025-12-23T13:24:00.993Z] [INFO] [Commands] handleCommand { cmd: 'vvip', userId: 123, chatId: 456 }
Γ£à VVIP response includes tier options and prices
[2025-12-23T13:24:00.994Z] [INFO] [Commands] handleCommand { cmd: 'analyze', userId: 123, chatId: 456 }
Γ£à Analysis response structured correctly
Γ£à User profile structure valid
Γ£à Currency formatting works (KES display)
Γ£à VVIP expiry calculation works
[2025-12-23T13:24:01.002Z] [INFO] [Commands] handleCommand { cmd: 'analyze', userId: 123, chatId: 456 }
Γ£à Gracefully handles missing API responses
[2025-12-23T13:24:01.003Z] [INFO] [Commands] handleCommand { cmd: 'menu', userId: null, chatId: 456 }
Γ£à Handles null/undefined values gracefully
[2025-12-23T13:24:01.004Z] [INFO] [Commands] handleCommand { cmd: 'analyze', userId: 123, chatId: 456 }
Γ£à Handles extremely long input gracefully
Γ£à Handles special characters and XSS attempts safely
[2025-12-23T13:24:01.010Z] [INFO] [Callbacks] handleCallbackQuery { callbackData: 'menu_main', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.011Z] [INFO] [Callbacks] handleMenuCallback { data: 'menu_main' }
[2025-12-23T13:24:01.012Z] [INFO] [Callbacks] handleCallbackQuery { callbackData: 'menu_odds', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.012Z] [INFO] [Callbacks] handleMenuCallback { data: 'menu_odds' }
[2025-12-23T13:24:01.014Z] [INFO] [Callbacks] handleCallbackQuery { callbackData: 'menu_analyze', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.015Z] [INFO] [Callbacks] handleMenuCallback { data: 'menu_analyze' }
[2025-12-23T13:24:01.015Z] [INFO] [Callbacks] handleCallbackQuery { callbackData: 'vvip_daily', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.015Z] [INFO] [Callbacks] handleVVIPCallback { data: 'vvip_daily' }
[2025-12-23T13:24:01.015Z] [INFO] [Callbacks] handleCallbackQuery { callbackData: 'pay_mpesa', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.227Z] [INFO] [Callbacks] handlePaymentCallback routed { data: 'pay_mpesa', userId: 123 }
[2025-12-23T13:24:01.228Z] [INFO] [Callbacks] handleCallbackQuery { callbackData: 'help_main', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.233Z] [INFO] [Callbacks] handleHelpCallback { data: 'help_main' }
[2025-12-23T13:24:01.233Z] [INFO] [Callbacks] handleCallbackQuery { callbackData: 'odds_live', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.234Z] [INFO] [Callbacks] handleOddsCallback { data: 'odds_live' }
[2025-12-23T13:24:01.235Z] [INFO] [Callbacks] handleCallbackQuery { callbackData: 'bet_fixture_12345', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.236Z] [INFO] [Callbacks] handleBettingCallback { data: 'bet_fixture_12345' }
[2025-12-23T13:24:01.236Z] [INFO] [Callbacks] handleCallbackQuery { callbackData: 'news_refresh', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.236Z] [INFO] [Callbacks] handleNewsCallback { data: 'news_refresh' }
[2025-12-23T13:24:01.236Z] [INFO] [Callbacks] handleCallbackQuery { callbackData: 'signup_start', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.237Z] [INFO] [Callbacks] handleSignupCallback { data: 'signup_start' }
Γ£à All 10 callback types route correctly
[2025-12-23T13:24:01.238Z] [INFO] [Commands] handleCommand { cmd: 'start', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.239Z] [INFO] [Commands] handleCommand { cmd: 'menu', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.244Z] [INFO] [Commands] handleCommand { cmd: 'help', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.244Z] [INFO] [Commands] handleCommand { cmd: 'odds', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.245Z] [INFO] [Commands] handleCommand { cmd: 'news', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.245Z] [INFO] [Commands] handleCommand { cmd: 'vvip', userId: 123, chatId: 456 }
[2025-12-23T13:24:01.248Z] [INFO] [Commands] handleCommand { cmd: 'pay', userId: 123, chatId: 456 }
Γ£à All response structures are valid and complete
Γ£ö NLP - Intent classification works with core commands (14.1605ms)
Γ£ö NLP - Edge cases and unknown intents (1.0471ms)
Γ£ö Command handlers - all commands exist and return valid responses (17.0231ms)
Γ£ö Command handlers - /start shows welcome message with buttons (3.4436ms)
Γ£ö Command handlers - /help returns comprehensive FAQs (1.2882ms)
Γ£ö Command handlers - /menu shows main menu with categories (1.0707ms)
Γ£ö Command handlers - unknown command handled gracefully (1.1478ms)
Γ£ö Betting sites - Kenya sites available with all info (1.0805ms)
Γ£ö Betting sites formatting - creates clickable keyboard (1.7594ms)
Γ£ö UI/UX - Odds response has structure and buttons (1.9525ms)
Γ£ö UI/UX - VVIP response with tier info (1.118ms)
Γ£ö UI/UX - Analysis response has structure (5.9624ms)
Γ£ö Data models - user profile creation and formatting (0.4991ms)
Γ£ö Data models - currency formatting (KES) (0.5585ms)
Γ£ö Data models - VVIP expiry calculation (0.5397ms)
Γ£ö Edge cases - handling missing services gracefully (0.9981ms)
Γ£ö Edge cases - handling nil/null values (0.9795ms)
Γ£ö Edge cases - very long fixture IDs (2.3771ms)
Γ£ö Edge cases - special characters in input (2.8136ms)
Γ£ö Callbacks - routing all callback types (228.2775ms)
Γ£ö Response structure - all responses have required fields (10.8686ms)
Γ£ö fetchArticleHtmlByLink returns wrapped HTML for example.com (270.4401ms)
[2025-12-23T13:24:02.553Z] [INFO] [UserService] ensureNoOnboarding: removed onboarding key for ACTIVE user { userId: 1000 }
{"ts":"2025-12-23T13:24:02.558Z","level":"INFO","msg":"proactive.ensureNoOnboarding","meta":{"userId":1000,"cleaned":true}}
{"ts":"2025-12-23T13:24:02.559Z","level":"INFO","msg":"proactive.backupDelOnboarding","meta":{"userId":1000}}
{"ts":"2025-12-23T13:24:02.560Z","level":"INFO","msg":"handleMessage: delegating to AI for ACTIVE user","meta":{"userId":1000}}
Γ£ö onboarding simulation: ACTIVE user with onboarding key should be cleaned and not intercept message (16.8491ms)
Γ£ö OpenLigaDBService instantiates without cache (3.1174ms)
Γ£ö OpenLigaDBService instantiates with CacheService (0.9019ms)
{"ts":"2025-12-23T13:24:02.148Z","level":"WARN","msg":"No redis provided to adapter; falling back to in-memory store"}
[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }
[DB INIT] Using DATABASE_URL: postgresql:*****@oroo23@db.yijnktghtbtgvrkdtzei.supabase.co:5432/postgres?sslmode=require
{"ts":"2025-12-23T13:24:04.398Z","level":"WARN","msg":"Drizzle insert failed, falling back to SQL","meta":{"raw":"Failed query: insert into \"payments\" (\"id\", \"user_id\", \"provider\", \"provider_ref\", \"amount\", \"currency\", \"status\", \"created_at\") values (default, $1, $2, $3, $4, $5, $6, $7) returning \"id\", \"user_id\", \"provider\", \"provider_ref\", \"amount\", \"currency\", \"status\", \"created_at\"\nparams: 5555,SAFARICOM_TILL,BETRIX5555PR,907.99,KES,pending,2025-12-23T13:24:04.279Z"}}
{"ts":"2025-12-23T13:24:04.401Z","level":"WARN","msg":"Raw pg insert failed, falling back to Redis","meta":{"raw":"getaddrinfo ENOTFOUND db.yijnktghtbtgvrkdtzei.supabase.co"}}
[2025-12-23T13:24:04.402Z] [INFO] [PaymentRouter] Payment order created {
  orderId: 'ORD55551766496242153',
  userId: 5555,
  paymentMethod: 'SAFARICOM_TILL'
}
{"ts":"2025-12-23T13:24:04.407Z","level":"WARN","msg":"No redis provided to adapter; falling back to in-memory store"}
[DB INIT] Using DATABASE_URL: postgresql:*****@oroo23@db.yijnktghtbtgvrkdtzei.supabase.co:5432/postgres?sslmode=require
Γ£ö payment flow: createPaymentOrder returns orderId (2261.5699ms)
{"ts":"2025-12-23T13:24:04.418Z","level":"WARN","msg":"Drizzle insert failed, falling back to SQL","meta":{"raw":"Failed query: insert into \"payments\" (\"id\", \"user_id\", \"provider\", \"provider_ref\", \"amount\", \"currency\", \"status\", \"created_at\") values (default, $1, $2, $3, $4, $5, $6, $7) returning \"id\", \"user_id\", \"provider\", \"provider_ref\", \"amount\", \"currency\", \"status\", \"created_at\"\nparams: 6666,PAYPAL,MOCKPAY-1766496244412,154.35,USD,pending,2025-12-23T13:24:04.413Z"}}
{"ts":"2025-12-23T13:24:04.419Z","level":"WARN","msg":"Raw pg insert failed, falling back to Redis","meta":{"raw":"getaddrinfo ENOTFOUND db.yijnktghtbtgvrkdtzei.supabase.co"}}
[2025-12-23T13:24:04.420Z] [INFO] [PaymentRouter] Custom payment order created {
  orderId: 'ORD66661766496244411',
  userId: 6666,
  paymentMethod: 'PAYPAL',
  amount: 150
}
Γ£ö payment flow: createCustomPaymentOrder returns orderId (13.1466ms)

≡ƒôÜ Payment Guides Test

- Checking guide for MPESA: OK
- Checking guide for SAFARICOM_TILL: OK
- Checking guide for PAYPAL: OK
- Checking guide for BINANCE: OK
- Checking guide for SWIFT: OK
- Checking guide for BITCOIN: OK
- Checking guide for NOWPAYMENTS: OK

Γ£à All payment guides present and non-empty

Γ£ö D:\betrix-ui (1)\betrix-ui\tests\payment-guides.test.js (420.4673ms)
≡ƒº¬ Payment Integration Tests

≡ƒôî Test: normalizePaymentMethod is a function
Γ£à PASS

≡ƒôî Test: createPaymentOrder accepts various method formats
[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }
[DB INIT] Using DATABASE_URL: postgresql:*****@oroo23@db.yijnktghtbtgvrkdtzei.supabase.co:5432/postgres?sslmode=require
{"ts":"2025-12-23T13:24:04.802Z","level":"WARN","msg":"Drizzle insert failed, falling back to SQL","meta":{"raw":"Failed query: insert into \"payments\" (\"id\", \"user_id\", \"provider\", \"provider_ref\", \"amount\", \"currency\", \"status\", \"created_at\") values (default, $1, $2, $3, $4, $5, $6, $7) returning \"id\", \"user_id\", \"provider\", \"provider_ref\", \"amount\", \"currency\", \"status\", \"created_at\"\nparams: 123456,SAFARICOM_TILL,BETRIX123456,2725.99,KES,pending,2025-12-23T13:24:04.778Z"}}
{"ts":"2025-12-23T13:24:04.805Z","level":"WARN","msg":"Raw pg insert failed, falling back to Redis","meta":{"raw":"getaddrinfo ENOTFOUND db.yijnktghtbtgvrkdtzei.supabase.co"}}
[2025-12-23T13:24:04.813Z] [INFO] [PaymentRouter] Payment order created {
  orderId: 'ORD1234561766496242847',
  userId: 123456,
  paymentMethod: 'SAFARICOM_TILL'
}
Γ£à PASS: Canonical key accepted
[DB INIT] Using DATABASE_URL: postgresql:*****@oroo23@db.yijnktghtbtgvrkdtzei.supabase.co:5432/postgres?sslmode=require
{"ts":"2025-12-23T13:24:04.819Z","level":"WARN","msg":"Drizzle insert failed, falling back to SQL","meta":{"raw":"Failed query: insert into \"payments\" (\"id\", \"user_id\", \"provider\", \"provider_ref\", \"amount\", \"currency\", \"status\", \"created_at\") values (default, $1, $2, $3, $4, $5, $6, $7) returning \"id\", \"user_id\", \"provider\", \"provider_ref\", \"amount\", \"currency\", \"status\", \"created_at\"\nparams: 123457,SAFARICOM_TILL,BETRIX123457,2725.99,KES,pending,2025-12-23T13:24:04.815Z"}}
{"ts":"2025-12-23T13:24:04.820Z","level":"WARN","msg":"Raw pg insert failed, falling back to Redis","meta":{"raw":"getaddrinfo ENOTFOUND db.yijnktghtbtgvrkdtzei.supabase.co"}}
[2025-12-23T13:24:04.823Z] [INFO] [PaymentRouter] Payment order created {
  orderId: 'ORD1234571766496244814',
  userId: 123457,
  paymentMethod: 'SAFARICOM_TILL'
}
Γ£à PASS: Common alias accepted and normalized
[DB INIT] Using DATABASE_URL: postgresql:*****@oroo23@db.yijnktghtbtgvrkdtzei.supabase.co:5432/postgres?sslmode=require
{"ts":"2025-12-23T13:24:04.828Z","level":"WARN","msg":"Drizzle insert failed, falling back to SQL","meta":{"raw":"Failed query: insert into \"payments\" (\"id\", \"user_id\", \"provider\", \"provider_ref\", \"amount\", \"currency\", \"status\", \"created_at\") values (default, $1, $2, $3, $4, $5, $6, $7) returning \"id\", \"user_id\", \"provider\", \"provider_ref\", \"amount\", \"currency\", \"status\", \"created_at\"\nparams: 123458,MPESA,,2739.49,KES,pending,2025-12-23T13:24:04.825Z"}}
{"ts":"2025-12-23T13:24:04.830Z","level":"WARN","msg":"Raw pg insert failed, falling back to Redis","meta":{"raw":"getaddrinfo ENOTFOUND db.yijnktghtbtgvrkdtzei.supabase.co"}}
[2025-12-23T13:24:04.831Z] [INFO] [PaymentRouter] Payment order created {
  orderId: 'ORD1234581766496244823',
  userId: 123458,
  paymentMethod: 'MPESA'
}
Γ£à PASS: M-Pesa STK alias accepted and normalized

≡ƒôî Test: createCustomPaymentOrder accepts various method formats
[DB INIT] Using DATABASE_URL: postgresql:*****@oroo23@db.yijnktghtbtgvrkdtzei.supabase.co:5432/postgres?sslmode=require
{"ts":"2025-12-23T13:24:04.837Z","level":"WARN","msg":"Drizzle insert failed, falling back to SQL","meta":{"raw":"Failed query: insert into \"payments\" (\"id\", \"user_id\", \"provider\", \"provider_ref\", \"amount\", \"currency\", \"status\", \"created_at\") values (default, $1, $2, $3, $4, $5, $6, $7) returning \"id\", \"user_id\", \"provider\", \"provider_ref\", \"amount\", \"currency\", \"status\", \"created_at\"\nparams: 123466,PAYPAL,MOCKPAY-1766496244834,154.35,USD,pending,2025-12-23T13:24:04.834Z"}}
{"ts":"2025-12-23T13:24:04.839Z","level":"WARN","msg":"Raw pg insert failed, falling back to Redis","meta":{"raw":"getaddrinfo ENOTFOUND db.yijnktghtbtgvrkdtzei.supabase.co"}}
[2025-12-23T13:24:04.843Z] [INFO] [PaymentRouter] Custom payment order created {
  orderId: 'ORD1234661766496244833',
  userId: 123466,
  paymentMethod: 'PAYPAL',
  amount: 150
}
Γ£à PASS: Alias normalized in custom order creation

≡ƒôî Test: Callback data method extraction (simulates telegram handler)
Γ£à PASS: Callback method extracted and normalized correctly

≡ƒôî Test: Signup payment callback parsing
Γ£à PASS: Signup callback method normalized correctly

≡ƒôî Test: Provider ref mappings use normalized keys
Γ£à PASS: Provider ref key format verified: payment:by_provider_ref:SAFARICOM_TILL:TEST_REF

≡ƒÄë All integration tests passed!

